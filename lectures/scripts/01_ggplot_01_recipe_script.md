So in this video we're going to be looking at charting in ggplot 2

ggplot is a package for charting in Rstudio.

Before we start getting straight into ggplot, let's have a look at a few charts and get a sense for what makes a good chart and perhaps what makes a bad chart.

So here's one that I quite like, this is a a chart of what's called a meta analysis. Each of the data points on this chart represent a scientific study that has been published that has something to do with cancer and food. Each of these scientific studies have have made some claim about a specific food type and whether it is a risk for cancer.

If the studey is suggesting that the food increases the risk of cancer it's on the right hand side of the plot and we say the relative risk for cancer more than one. If the study suggests the food offers some protection from cancer then the relative risk is less than one which would be on the left hand side. So studies on the right are showing that the food increases the risk for cancer, whilst those studies on the left are suggesting the food reduces the risk of cancer.

And you can see that each of the studies gives a different estimate of the magnitude of the food effect on cancer. So you can see that a bunch of studies say that wine is protective, while some other studies say that wine is a risk and so on. Most of the foods have some studies saying that they're good and some studies saying that they're bad and this is what can lead to conflicting articles in the news. One week you'll see an article on a news website saying that you should increase your red wine intake because it helps prevent cancer and then you'll see another article a couple of weeks later saying that actually you should decrease your red wine intake as it increases cancer, right?

Unfortunately there is a few here that are one-sided so you can see that bacon for example, most studies on bacon have said that's that's not so good and pork in general is not so good, but some things are good! So olives do seem to be protective across all studies but of coursethere's a lot of range between the size of the effect and so the take home message from this chart is that observational studies like this can be inconsistent from study to study. That might be to do with the study design or it might be to do with the people that they studied and many other things, so you've got to be a little bit skeptical when you read claims.

Here's some other charts which aren't perhaps what you might consider a traditional chart - instead it's a visualization of what would happen under certain circumstances so this is the flatten the curve one so the idea is that if we did or didn't implement a particular policy around around covid such as vaccine mandates then you would expect to see a different outcome.

Here's another one that that shows the the idea of exponential growth of the number of infections and what would happen if that is limited in some way right, which is quite a nice visualisation of the advantages of intervening early, showing how many illnesses can be prevented.

Here's another covid one. So this is the number of cases and you know one of the nice things about this is this is cases per 100,000 people, so it's already adjusted for the size of the population and you can compare across across countries.

This is another one so this is something that the New York Times did back in the 2016 US election when Donald Trump first won over Hillary Clinton. They had this needle implemented which basically shows the forecast of what they were predicting the overall popular vote would be as the election results were coming in. It shows some historical data as well, so there's the margin that Obama had in 2008 and in 2012 and then this is showing what they predict is going to happen in 2016. The needle jumping about here is giving an idea of the uncertainty in this prediction as not all the votes are counted yet. When this was published it made a lot of people anxious because the needle was jumping about all over the show and of course would sometimes flick over to the right and turn red and that made people really anxious and that kind of makes sense in that the outcome is uncertain. When the outcome is uncertain and it's something that you care about a great deal perhaps it should make you a little bit anxious!

So here's one of mine so this is work on campybacteriosis in the Manawatu. So this is a map of the Lower half of the North Island with Wellington down here, Taranaki is over here and Napier here and Auckland way up the top there. Palmerston North is the urban center you can see. What this is showing is the risk of campylobacteriosis before 2007 on the left and after 2007 on the right. The browner colors signify increased risk of campylobacteriosis and the greener colors lower risk. So you can see that in the city of Palmerston North there was increased risk of campylobacteriosis compared to the average before 2007 and after 2007 you can see that Palmerston North is mostly green so the urban areas switched from being a risky area to less risk. The gray clouds here are the clouds of uncertainty so they're capturing the fact that we're not completely certain about the risk. In many of these areas, particularly in the rural areas we may not have many (or even any) reported cases of campylobacteriosis so we're doing a sort of a smoothing process through space and time in order to estimate the the case rate in those areas.

When we zoom in on Palmerston North you can see you can see the difference a little clearer. Massey University is down here and here is the river and I live somewhere in here.

Right, so let's just have a look at a few bad examples of charts. So these are not hard to find unfortunately! This is one that was published on the Herald and you can see here from this pie chart that they attempted to break down the cost of petrol into the various components and you can clearly see that this 35% chunk here which is the actual cost of the refined fuel is smaller than this fuel excise segment in orange which represents 30%. So that the size of the wedges aren't in proportion to the size of the numbers.

And because this is a contentious issue and people talk about it frequently there's actually a lot of great data available from the Ministry of Business, Innovation and Employment. They provide weekly data on this so you can see the fluctuations through time if you're interested, and it's fully broken down into these various costs so you don't have to rely on the reporting of this which tends to be a bit suspect.

Here's another one so this is from the election a couple of times ago I think and it was put out by the National party. You can probably guess that the idea of it is to show that things were worse under the then Labour government than they were under the previous National government, but there's lots wrong with it right? So the height of the bars have nothing to do with the numbers. This is a bigger bar but it's not scaled and proportional the number, and similarly the tax amounts aren't scaled, so the tax here \$1.12 is about half of \$2.23 um and so it should be about half of the bar, but it's not.

Ofcourse this is intentionally misrepresenting the data to try and make a political point, but this was actually ruled as okay by the Advertising Standards Authority, so perhaps they don't have many standards!

So the general rules when we make a chart is to not mislead or at least not do so intentionally. One way to do that is ensure that you can compare like with like. So for example when we are comparing across countries, we don't just show raw numbers, as countries with much larger populations are going to have higher numbers. The denominator is important.

And when you're representing lengths or magnitudes on a chart then including zero is important so axes should start at zero so that the length of the thing that you have on there represents the actual value. So a bar chart is a classic example for this.

It's also useful to show where the data came from and how you generated the chart um so one of the things that we'll be learning is how to create charts with code. We'll be writing code to generate charts and the advantage of doing so is that chart is completely reproducible by both yourself and by others. It also necessarily shows you where you got your data from, because you have to have that data in front of you in order to run your code.

The last point is that it's ideal if you show variation or uncertainty where you can so often the underlying story might be the trend of something which might be some average. But you've got to place that average in context. How much variation is there around that average? It doesn't make much sense just saying you know that the average height of people in New Zealand is, say 1.7m tall, as that doesn't tell you anything about the actual height of a particular person, right? Most people won't be exactly 1.7m tall, they're going to be tall or shorter than that, so having some idea of the variation around that average is important.

So here's another example of poor reporting. So the headline is "More students cheat in exams and most are in Auckland" and technically that is correct, but the data was actually included in the article if you want to click on it. And if you do you'll find the number of cheats hasn't really changed in fact it's gone down a little bit compared to previous years. They also say that most cheats are in Auckland and that's also true, but it's kinda useless information, right? As most students are in Auckland as it's the largest urban center, so any comparison across regions needs to account for the number of students in each region differing. Ofcourse we have that data, so we can work out the "cheats per 1,000 students" rate. When we do we find that Auckland is higher but it's not super high and in fact Northland and the west coast of the South Island are in fact where most cheaters are.

Okay so now we're going to start learning about how we create charts using the particular package that we're going to be learning which is ggplot 2.

So ggplot 2 is a package for the statistical software R developed by Hadley Wickham. So Hadley is originally a New Zealander that studied statistics at Auckland University among other places and his now the Chief scientist at Posit which is the firm that makes the software RStudio which we will be using.

It's based on the idea of a of a grammar of graphics and the idea is that it uses a consistent language to produce different plots. That makes it extremely flexible particularly for complex plots because everything about the plot can be changed but one of the potential downsides is you have to type quite a lot to get each plot.

But the reason that you have to type quite a lot is because of that flexibility, and you'll find that as we go through once we get to about week three or four, suddenly the sort of things that we can achieve with the 'recipe' that we learn is quite substantial. We can make quite complex plots that convey multiple aspects of the data at the same time using essentially the same syntax as we would for a simple scatter plot.

So here's one. This is the location of earthquakes around Fiji and this is their locations in terms of longitude and latitude. I think Fiji is up here somewhere and New Zealand is down here.

And you can see that there's a reasonable amount to type here. We have this ggplot thing which we feed some data to and then we give it a mapping from our data to the features of the plot, and then tell it what type of plot we want.

The idea is that there's a recipe behind that and we'll see what that is in a moment but before we do let's have a look at some resources. What you'll find is that there's a huge amount of information and places on the web to get support for R the statistical language in general and for the particular parts of R that we're going to be using which is basically the Tidyverse. There are books written purely about data wrangling for example using dplyr and tidyr which we'll be looking at a little bit later on and there are books written about ggplot2 which is the main package that we use for charting.

In addition you can always ask within our Discord channel and within stream or via email. I prefer Discord as the primary point of call simply because it's really fast to get an answer as there'll be other students around that might know things even if one of the teaching staff isn't around.

So what is the Grammar of Graphics? The basic idea is to specify building blocks for making plots and then combine those blocks in order to produce a final chart. So we start with some data and that data always takes the same form of a data frame, which is basically a rectangle of data where you have rows representing your observations and columns representing the measures on those observations. Then you have some Aesthetics which are features of the plot like your X axis, your Y axis, colours, the size of points, the shape of points and so on. Some of those might be used to represent measures (columns) in your data on the chart.

You then have different geometries to use to represent the observations in your data on the chart, so that might be might be points, it might be lines, it might be summaries of the data such as box plots or histograms or densities. Then there might be some transformation involved where our data are perhaps better represented on a logarithmic scale and related to that we'll have scales and coordinate systems involved as well. These might be really simple like x and y axis scales, or might be more complicated like polar coordinates or mapping coordinate reference systems.

There's also positioning of points, such as adding jitter or shifting points to distinguish subgroups, and lastly there's the idea of faceting which creates small multiple plots, where we take the same plot and reproducing it a bunch of times using different subsets of the data.

So we're going to start with some data on penguins, so you can get this data in the Palmer Penguins package by writing library(palmerpenguins) to load that up and you can see that it consists of a bunch of measures on a bunch of penguins of different types. We've got the body mass, we've got the flipper length, bill depth, bill length, and we've got the species that they're from and the island on which they were observed. You can read about the data with these links here if you wish.

So a plot on penguins we could we could look at perhaps plotting the relationship between how long their flippers are and their body mass and you might expect that the penguins with longer flipper lengths will be larger and thus weigh more, and that's of course what we see.

And so to plot this we have the same form as we saw earlier with the earthquake data. We have this ggplot thing with some data, we have something telling us which measures in the data are to be plotted, and we have a geometry and that's the basics of recipe.

To create a chart with ggplot we need to tell R we want a plot by invoking the ggplot function we then tell ggplot what data we're playing with by specifying the data argument to ggplot in this case data equals penguins because penguins is the name of our data set. Then we add on a bit that lets ggplot know how to get from measures in our data to features of the plot. It needs to know what "x" and "y" should mean on the plot. On the earthquake data that was longitude and latitude, and on the penguins data it was body mass and flipper length. Finally we specify the type of geometry to use, which in both cases so far has been points to give a scatterplot. All of our charts are going to follow this same recipe there just might be a few few extra ingredients added to them.

So the recipe is tell ggplot what data we want to plot, so in this case data is set to penguins as that's the name of our data frame. We then need to describe the aesthetics of the plot, i.e. which variables or measures in the penguins data frame are we wanting to see on the plot, and which features of the plot should they use? This is the aes() bit, short for aesthetics, where you can see we've set x to flipper_length_mm and y to body_mass_g which are the names of the columns in the penguins data set. Next we specify the type of geometry that we want to use to represent the observations in our data set, and we've chosen points.

So that's the recipe and the advantage of the recipe is that then we can easily change it, so here I've changed the recipe by mapping another feature of the plot to another measure in the data so that the colour of points changes based on the penguin species. So previously the points had no color they were just all black, whereas now the color corresponds to a feature of the data, the species. When I do that I automatically get a guide that's telling me what the red and the green and the blue represent. Just like when I specified X and Y it automatically gave me a gave me a guide for X (the x-axis) and a guide for Y (the y-axis), and generally ggplot does pretty well at getting those guides correct out of the box.

So the recipe is always the same we tell R we want a chart with ggplot, we tell ggplot what data we're plotting by mapping the data argument to the name of our data set, we then choose which features of the plot we wish to use to represent measures in our data set, and then select a geometry type, and that's it.

The key idea from this video is that all ggplots follow the same basic recipe, but that they may have slightly different ingredients depending on what we want to show. We'll be be looking at some different ingredients in the next few lessons.
