In this video we're looking at scales and colors in ggplot2 charts

The data today we're going to be using is the Penguin data again from the Palmer Penguins package but also some data from Horizon's Regional Council here in the Manawatu 2 region on river quality. In particular we're going to be looking at the counts of E. coli as an indicator of faecal contamination. so E. coli is a bacteria that lives quite happily in the back end of many animals and therefore we also find it in water when that the E coli find its way into the water through fecal contamination. So here's the data set here which you can read in and have a look for yourself if you like and you can see that we have about 14,000 rows. Many of the columns here aren't strongly informative so the indicator line is always E. coli and the council line is always Horizons as this comes from a much larger data set where there's different indicators, from Land, Air and Water Aotearoa and you can find the a link down there to the complete LAWA data if you want. We've also got the date of the measure and where it was measured as a site ID as well as site name. Then we have a raw value which is how the data came which has been decoded into a symbol and an actual value as a number.

So we have E. coli counts from 93 sites throughout the Horizon's region. Here's some code that produced that result which we'll be looking into when we cover data manipulation. You can see this has just summarised how many rows in the `hrc` data set do we have for each site, so we can see that the Arata drain at Hokio Beach Road has 142 observations and others have fewer observations, simply because some sites have been monitored for longer than others. And it turns out that the counts of E. coli have a huge range so we have some very low counts of just one and very high counts over 240,000 with half the counts being less than 155. So we've worked out the the minimum value, the maximum value, and the median value here so you can see that half the counts are less than 155 and some of the counts are as high as 240,000 so these counts naturally "live" on a log scale and the reason for that is that is the concept of exponential growth. Bacteria populations grow by cell division, where each bacteria divides into two repeatedly right so from an initial single cell you get two cells then four cells then 8 cells and 16 cells and so on and so forth so each generation grows in size exponentially. That's the reason we get these very high counts sometimes. So when we look at charting these data we are going to have to take into account the fact that the numbers are exponential so when we plot it we have to sort of take away the exponential nature of the data by using a log transform in order to be able to show the variation at the lower end otherwise all we're going to see is the is the much larger variation at the upper end. If you think about plotting these data with a histogram right the x axis would range from 1 to 240,000 and half the data would be less than 155 so you'd have basically a spike at the start and after that you wouldn't see anything else. So we need a change of scale in order to adequately summarize these data, and we're going to look at how we do this in ggplot by altering scales. Further we're going to also look at altering colors which is done by the same mechansim.

Each aesthetic or each feature of the plot that we have in ggplot has an associated scale, and these are usually generated automatically for you, but on occasion will need to be altered. For example X and Y those aesthetics for a scatter plot they have axes associated with them right they're the x- axis and the y- axis which has the range of values on the X and the range of values on the Y and how those values on the X and Y distributed within that range. When we add color to the plot then we get a guide or a legend so that is also an idea of scale. If the colors are for a continuous measure then we would have a color gradient fading from say a light blue to a dark blue through to Black for example, so depending on what the color is on the plot tells you where it is on that scale. You can change the scale through a transformation or change the limits of the scale if we want to. If we instead have a grouping variable we can change for example what colors are associated with each group and we do all of this through the scale functions. So because all of these things are scales they are all changed through the same set of functions.

There's a set of scale_x functions to change the x-axis, there's a set of scale_y functions to change the y axis, there's scale_color functions to change colour, or scale_fill to change the fill colour and so on. Each aesthetic has a corresponding set of scale functions.

So let's have a look at some of them. We're going to have a look at our flipper length by body mass of our Penguins and we're going to start by changing the x-axis scale so we're going to use scale_x_continuous and one of the things that we can change there is we could change the limits if we want. By default ggplot usually does a pretty good job of choosing the limits so you can see here that for body mass the values go between about 2,700g up to maybe 6,300g so what ggplot does is extend the range a little bit from that by default, and it's done the same thing with flipper length. If you want to change the limits you can do so. For example, sometimes you might have a meaningful value that you want to include on the axis that is outside the range of the data. It might be that you have some other penguin that weighs 10,000g and you might want to include that weight as a comparator. Or maybe you're plotting a proportion that is typically quite high, like the proportion of people vaccinated and that's hopefully going to be a high number and so by default the range of the data may vary only from say 60% to 90%. But because 0% and 100% are useful quantities in that context, you might want to extend the axes to go from 0 to 100 so that you can actually see the context because if your axis actually ran only from 60 to 90 then you would see a lot of variation from 60 to 90 which might give you the suggestion of a larger movement than is actually taking place - it depends a little bit on the context. Other times we may want to change the axis scale in a different way so instead of this one where we just squash the data up maybe we want to instead zoom in on the data in on the data by giving a smaller limit so you could zoom in and say you know you you want the flipper length from say 180 to 220 and it would zoom in on that portion of the data and throw away anything outside of it.

In other cases uh the data are such that if you plot them on a natural scale then they're just not very useful so here is the Horizons Regional Council E. coli counts by time so we've got so R has correctly identified that this is a date variable and because of that ggplot has given us sensible date labels for the x-axis so it's automatically recognized that it's a date which is handy. And then the y-axis are the counts and all we can see here is the big ones, because we saw earlier that half of the counts are less than 150 and if you think about where 150 lies on this axis it's essentially close to zero so half the data is right across the base odf hte chart so all we're seeing are the biggest observations which are infrequent. It's hard to tell whether there's been any change at all over time here because we can't see most of the observations on the plot.

So in this case we'd want to do a a transformation that allows us to focus on the small observations as well as the large ones and so the classic one to do is a log transform. So `scale_y_log10` does a log base 10 transformation. It doesn't actually matter what base your log is and log base 10 is often understood a little bit easier by those that perhaps don't have as solid a math background, but the idea here is that on a log 10 basis a constant gap on the x-axis corresponds to a multiplying by 10 so as you multiply by 10 so you go 1 10 100 1,000 10,000 100,000 and so on and you can see that that's what it's done to the y-axis. So here it's in exponential notation which makes it a bit more complicated than it needs to be 1e1 means 10\^1 etc so each of the lines is going up in a multiple of 10 and now of course those extreme observations the ones that we could see before are just a small step up so that the extreme values have been pulled down and that makes sense in this case because of that doubling nature of the E. coli counts. The exponential nature of those things means that a value of 100,000 compared to 50,000 is the same as a value of 100 compared to 50 right those two things should be considered the same because it's just another generation in the bacterial growth process so those two stages if you like take the same length of time and so they should be shown as the same increment on the axis. And so when we do this we can see that by the looks there doesn't seem to be much change in trend, that the average number of E. coli that we've seen has stayed about the same over time at a little over 100.

And we could perhaps look at that by putting a smoother through it - we could put push all the the data into the background a little bit with some transparency and then we've added a smoother across to look at the average trend and we can see that it's essentially flat right. There are some other interesting things though so notice all the horizontal stripes. That's of course that at these low values. There's only a small number of values at the low end. So we can see an interesting thing that we used to record values as low as 1 but after about 2012 or 2013 the lowest value we see is this value here which is 4 and this is really just a limited detection thing right the actual count down here we're not picking up just one bacteria or four bacteria it's it's due to the testing process the counting process. There's lower resolution at the low concentrations.

Interestingly there's also a pattern up here stripes through here and I wonder whether that might be an upper limit of detection - the point where you get so many E. coli that you can't really count them all perhaps.

Okay so there's lots of things to think about that the high values might be higher or the low values might be a bit lower, but you get the good sense that essentially the counts over time of E. coli in the HRC regions rivers have basically stayed the same over time: things aren't getting better but things aren't getting dramatically worse either.

So that's scales. Generally the idea is that if the data obviously live on an exponential scale so you have some growth idea associated with them or if percentage changes for example is what matters then putting things on a log scale often makes sense. The other case would be things like asset values like house prices or other investments. House prices tend to live on a log scale as well as those assets tend to increase in value by a proportion of their current value over time. In addition there's often a spread within house prices with a bunch of so-called cheaper houses at the lower end and fewer much more expensive houses at the high end and so plotting them on a log scale makes sense because then the scales aren't dominated by the few mansions.

What about changing colors? So that's another scale. So here you can see when we've added a colour aesthetic, ggplot has given us some colours by default. Unfortunately the colours it gives by default are a little poor - by default it gives basically a rainbow by varying the hue of the colour or where it sits on a colour wheel while keeping luminance the same. That's not ideal because many people have some form of color blindness. A common one is red/green color blindness which affects around 1/9th of males so some of you that are watching this may not be able to distinguish between the Adelies and the Chinstraps. So it often makes sense to change the colors, particularly if you're presenting to a general audience. Another reason for changing the colours is for the medium it will be viewed on. Projectors for example are often poor at reproducing yellow, particularly on white backgrounds. If you were to print out these colours on a black and white printer, they'd all look very similar as the luminance is the same.

So one way to do this is to choose the colors yourself and define them manually so `scale_color_manual` allows you to specify a set of values that map from the groups in your data in to colours. So one of the parameters that you can supply to `scale_color_manual` is `values` which takes a named vector or a named collection of observations if you like. And you set up the name of your groups and the color that you want separated by commas. So here we're saying that the Adelie should be dark green, the Chinstrap should be that maroon color and the Gentoo penguins should be orange. So this `c()` function that we've used here that's short for combine, a really common operation to do is to put multiple observations together and treat them as a unit, so it's got a short hand which is `c()`. And we have what's called a named vector in this case because each of the entries the dark green, the maroon and the orange have names "Adelie", "Chinstrap" and "Gentoo".

The other way to do this is to set up a variable to hold those colours and then we can just assign that variable to the `values` parameter in `scale_colour_manual()`. That's useful if you're doing more than one plot as you can re-use it, and also because it helps separate out the things that you that you're specifying that are somewhat fixed and might apply across multiple charts such as the penguin colors and the actual generation of the plot, so we don't have a bunch of definition type things inside the plot command, we just have the features of the plot there.

There's also a number of pre-built palettes that you can utilise. One of them is the `viridis` package which has a bunch of colour palettes that work well in many contexts. It has some colour gradients and also some discrete palettes for grouping variables. `scale_colour_viridus_d()` is a discrete palette useful for grouping variables and that will automatically then choose three colors that are not prone to color blindness issues and are usually also good for differentiating on paper if you print it out gray scale for example. So here you can see we've got this purple, blue and gold color. The viridis palettes are typically designed for continuous measures so are based on a gradient of colors so if we had say six groups it would be choosing six colors on the same gradient from purple through Blues through greens through yellows.

Another one is the Brewer package so this is a really popular one - there's a website you can use to look at the brewer palettes which have been designed to be color blind safe. The brewer palettes were originally designed for maps, and there's some that are gradients but there's also some discrete ones for grouping.

We've used the dark2 palette here. So again these are palettes that are designed by other people that know lots of lots of things about color what good combinations there are and there are a bunch of other ones as well.

For example there's a package called `Manu` which are based off the colours featured in Aotearoa native birds, so for example you can use a set of colors that have been derived from a kokako for example or a Kaka or Tui. And these are done by extracting colours from a photo. There's also a Wes Anderson set of palettes based off his movies which often utilise a particular set of colour tones.

So the key idea is that it's useful sometimes to change scale. The big one is where the data live on an exponential scale and you need to use a log, the other case is when special values outside of the range of data that you have are important to show on the plot so for example proportions lie between zero and one and sometimes those values are important.

Usually ggplot does a pretty good job of axis limits by default, so usually you have to have a good reason to change them.

ggplot's colours aren't so good by default. They're fine for a quick look at the data, but for presenting your work to others it's often better to branch out with the colours. Colours give you the opportunity to add a bit of personality to your chart.

One thing to think about with colours is consistency: often in a statistical report you will have more than one chart. It's important to ensure there is some consistency in the colour use across charts, as then your reader always knows that the blue tone refers to the same thing in multiple places.
